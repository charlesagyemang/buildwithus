<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>The Nect</title>
        <meta name="keywords" content="HTML5,CSS3,Admin Template" />
        <meta name="description" content="" />
        <meta name="Author" content="Psd2allconversion [www.psd2allconversion.com]" />

        <!-- mobile settings -->
        <meta name="viewport" content="width=device-width, maximum-scale=1, initial-scale=1, user-scalable=0" />
        <!--[if IE]><meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'><![endif]-->

        <!-- WEB FONTS : use %7C instead of | (pipe) -->
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400%7CRaleway:300,400,500,600,700%7CLato:300,400,400italic,600,700" rel="stylesheet" type="text/css" />

        <!-- CORE CSS -->
        <link href="../assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/metis-menu/metisMenu.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/simple-line-icons-master/css/simple-line-icons.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/animate/animate.css" rel="stylesheet" type="text/css" />
        <link href="../assets/plugins/c3/c3.min.css" rel="stylesheet">
        <link href="../assets/plugins/widget/widget.css" rel="stylesheet">
        <link href="../assets/plugins/calendar/fullcalendar.min.css" rel="stylesheet">
        <link href="../assets/plugins/ui/jquery-ui.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="../../css/style.css">

        <!-- THEME CSS -->
        <link href="../assets/css/style.css" rel="stylesheet" type="text/css" />
        <link href="../assets/css/theme/dark.css" rel="stylesheet" type="text/css" />

        <!-- PAGE LEVEL SCRIPTS -->

    </head>
    <body class="fixed-top">

        <!-- wrapper -->
        <div id="wrapper">
            <!-- BEGIN HEADER -->
            <div class="page-header navbar navbar-fixed-top">
                <!-- BEGIN HEADER INNER -->
                <div class="page-header-inner ">
                    <!-- BEGIN LOGO -->
                    <div class="page-logo">
                        <!-- <a href="index.html">
                            <img src="../assets/images/logo.png" alt="absolute admin" class="img-responsive logo-default"/> </a> -->
                            <p><h2>Welcome</h2></p>

                    </div>
                    <div class="menu-toggler sidebar-toggler">
                        <a href="javascript:;" class="navbar-minimalize minimalize-styl-2  pull-left "><i class="fa fa-bars"></i></a>
                    </div>

                    <!-- <div class="search-bar">
                        <form class="sidebar-search  " action="page_general_search_3.html" method="POST">

                            <div class="input-group">
                                <input type="text" class="form-control" placeholder="Search...">

                            </div>
                        </form>
                    </div> -->
                    <!-- END LOGO -->

                    <!-- BEGIN TOP NAVIGATION MENU -->
                    <div class="top-menu">
                        <ul class="nav navbar-nav pull-right">
                            <!-- BEGIN NOTIFICATION DROPDOWN -->
                            <li class="dropdown dropdown-extended dropdown-notification" id="header_notification_bar">
                                <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true">
                                    <i class="icon-bell"></i>
                                    <span class="badge badge-default"> <span class="ring">
                                        </span><span class="ring-point">
                                        </span> </span>
                                </a>
                                <ul class="dropdown-menu animated flipInX">
                                    <li class="external">
                                        <h3>
                                            <span class="bold">12 pending</span> notifications</h3>
                                        <a href="page_user_profile_1.html">view all</a>
                                    </li>
                                    <li>  <ul class="dropdown-menu-list scroller" data-handle-color="#637283">
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">just now</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-success">
                                                            <i class="fa fa-plus"></i>
                                                        </span> New user registered. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">3 mins</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-danger">
                                                            <i class="fa fa-bolt"></i>
                                                        </span> Server #12 overloaded. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">10 mins</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-warning">
                                                            <i class="fa fa-bell-o"></i>
                                                        </span> Server #2 not responding. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">14 hrs</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-info">
                                                            <i class="fa fa-bullhorn"></i>
                                                        </span> Application error. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">2 days</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-danger">
                                                            <i class="fa fa-bolt"></i>
                                                        </span> Database overloaded 68%. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">3 days</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-danger">
                                                            <i class="fa fa-bolt"></i>
                                                        </span> A user IP blocked. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">4 days</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-warning">
                                                            <i class="fa fa-bell-o"></i>
                                                        </span> Storage Server #4 not responding dfdfdfd. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">5 days</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-info">
                                                            <i class="fa fa-bullhorn"></i>
                                                        </span> System Error. </span>
                                                </a>
                                            </li>
                                            <li>
                                                <a href="javascript:;">
                                                    <span class="time">9 days</span>
                                                    <span class="details">
                                                        <span class="label label-sm label-icon label-danger">
                                                            <i class="fa fa-bolt"></i>
                                                        </span> Storage server failed. </span>
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>

                            <!-- END TODO DROPDOWN -->
                            <!-- BEGIN USER LOGIN DROPDOWN -->
                            <li class="dropdown dropdown-user">
                                <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown" data-close-others="true" aria-expanded="false">
                                    <img alt="" class="img-circle" src="../assets/images/avtar-1.jpg">

                                </a>
                                <ul class="dropdown-menu dropdown-menu-default">
                                    <li>
                                        <a href="page_user_profile_1.html">
                                            <i class="icon-user"></i> My Profile </a>
                                    </li>
                                    <li>
                                        <a href="app_calendar.html">
                                            <i class="icon-calendar"></i> My Calendar </a>
                                    </li>

                                    <li>
                                        <a href="page_user_login_1.html">
                                            <i class="icon-key"></i> Log Out </a>
                                    </li>
                                </ul>
                            </li>

                        </ul>
                    </div>
                    <!-- END TOP NAVIGATION MENU -->
                </div>
                <!-- END HEADER INNER -->
            </div>
            <!-- END HEADER -->
            <!-- BEGIN HEADER & CONTENT DIVIDER -->
            <div class="clearfix"> </div>
            <!-- END HEADER & CONTENT DIVIDER -->

            <!-- BEGIN CONTAINER -->
            <div class="page-container"> <aside class="sidebar">
                    <nav class="sidebar-nav">
                        <ul class="metismenu" id="menu">
                          <li>
                              <a href="#"><i class="icon-basket"></i> <span class="nav-label">Orders</span><span class="fa arrow"></span></a>
                              <ul class="nav nav-second-level collapse">

                                  <li class="active"><a href="../received"><i class="fa fa-shopping-cart"></i> Received<span class="label label-rouded pull-right p3-bg note-icon"><h9 id="span-orders">New 0</h9></span></a></li>
                                  <li><a href="../processing"><i class="fa fa-spinner"></i> Processing </a></li>
                                  <li><a href="../processed"><i class="fa fa-check"></i> Processed </a></li>

                              </ul>
                          </li>
                            <li>
                                <a href="#"><i class="fa fa-building-o"></i> <span class="nav-label">Plans</span><span class="fa arrow"></span></a>
                                <ul class="nav nav-second-level collapse">
                                    <li><a id="modal-add-plan-left" href="#" data-toggle="modal" data-target="#addAPlanModal"><i class="fa fa-plus"></i> Add Plan</a></li>
                                    <li><a href="../edit_plans"><i class="fa fa-edit"></i>Edit Plans</a></li>
                                    <li class="active"><a href="#"><i class="fa fa-list"></i> View All Plans <span class="label label-rouded pull-right p3-bg note-icon"><h9 id="span-plans"> 0 </h9></span></a></li>
                                </ul>
                            </li>
                            <li class="active">
                                <a href="#"><i class="fa fa-briefcase"></i> <span class="nav-label">Appointments</span><span class="fa arrow"></span></a>
                                <ul class="nav nav-second-level collapse in">
                                    <li><a href="#"> <i class="fa fa-inbox"></i> Received <span class="label label-rouded pull-right p3-bg note-icon"><h9 id="span-appointments">New 0</h9></span> </a></li>
                                    <li><a href="../approved_appointments"> <i class="fa fa-check"></i> Approved</a></li>
                                    <li><a href="../honored_appointments"><i class="fa fa-check"></i><i class="fa fa-check"></i> Done</a></li>
                                </ul>
                            </li>


                            <li>
                                <a href="widgets.html"><i class="fa fa-cog"></i> <span class="nav-label">Settings</span></a>

                            </li>

                        </ul>
                        <!-- END SIDEBAR MENU -->
                        <!-- END SIDEBAR MENU -->
                    </nav>
                    <!-- END SIDEBAR -->
                </aside>

                <!-- BEGIN CONTENT BODY -->
                <div class="page-content-wrapper">
                    <div class="content-wrapper container">

                        <div class="row">
                            <div class="col-sm-12">
                                <div class="page-title">
                                    <div class="row">

                                        <a href="../"><h4 class="pull-left">Appointments</h4></a>


                                        <ol class="breadcrumb pull-right">
                                            <li><a href="../"><i class="fa fa-home"></i></a></li>
                                            <li>All Appointments</li>
                                        </ol>

                                    </div>
                                </div>
                            </div>
                        </div><!-- end .page title-->

                        <div class="row">

                            <div class="col-sm-12">
                              <div class="col-lg-12">
                                <table class="table table-bordered table-striped">

                                </table>
                                <!-- <div class="dv-get-all:appointements:appointments_table dv-label:appoint"> -->
                                <table class="table table-bordered table-striped">
                                  <thead>
                                    <tr>
                                      <th>Name</th>
                                      <th>Phone</th>
                                      <th>Type</th>
                                      <th>Time</th>
                                      <th>Day</th>
                                      <th>Approve</th>
                                      <th>Disapprove</th>
                                    </tr>
                                  </thead>

                                    <tbody id="table" class="dv-get-all:appointements:appointments_table dv-label:appoint">
                                        <!-- <tr >
                                          <td id="name"class="var-name"></td>
                                          <td class="var-phone_number"></td>
                                          <td class="var-appointment_type"></td>
                                          <td class="var-time"></td>
                                          <td class="var-day"></td>
                                          <td >click  <button class="btn btn-primary approve   var-id" type="button" name="button"></button> to approve</td>
                                          <td> click  <button class="btn btn-danger disapprove var-id" type="button" name="button"> </button> to disapprove</td>
                                        </tr> -->

                                    </tbody>
                                  </table>
                                      <br><br><br><br><br><br><br>  <br><br><br><br><br><br><br>
                              </div>



                            </div>

                        </div>

                    </div>
                    <div class="clearfix"></div>
                    <div class="footer">

                    </div>
                </div>
                <!-- END CONTENT BODY -->
            </div>
            <!-- END CONTAINER -->
        </div>
        <!-- /wrapper -->

        <!-- Modal -->
<div id="addAPlanModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <center>
          <h4 class="modal-title">Add A Plan</h4>
        </center>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div class="col-lg-3">

          </div>
          <div class="col-lg-6">
            <br>
            <label for="name">Name</label><br>
            <input  id="input-name" class="form-control" type="text" name="name" value="">
            <label for="price">Price</label><br>
            <input id="input-price" class="form-control" type="text" name="price" value=""><br>

            <button id="btn-main-image" class="btn btn-primary" type="button" name="mImage">Upload main image</button>
            <label  id="label-mImage" for="mImage">No Image Uploaded Yet</label><br> <br>
            <label for="description">Description</label><br>
            <textarea id="txt-description" class="form-control"  name="description" value=""></textarea><br>

            <button id="btn-other-images" class="btn btn-primary" type="button" name="mImage">Upload other images</button>
            <label  id="label-other-images" for="otherImages">Images Not Uploaded Yet</label><br>
          </div>
          <div class="col-lg-3">

          </div>
        </div>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button id="modal-close-plan" type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button id="btn-add-plan-devless" type="button" class="btn btn-primary">Add Plan </button>
      </div>
    </div>

  </div>
</div>



        <!-- SCROLL TO TOP -->
        <a href="#" id="toTop"></a>


        <!-- PRELOADER -->
        <div id="preloader">
            <div class="inner">
                <span class="loader"></span>
            </div>
        </div><!-- /PRELOADER -->


        <!-- JAVASCRIPT FILES -->
        <script src="https://buildgallery.herokuapp.com/js/devless-sdk.js" class="devless-connection" devless-con-token="41b1f8b6dd4823f63f8eeed626bfafa8"></script>

        <script type="text/javascript" src="../assets/plugins/jquery/jquery.min.js"></script>
        <script type="text/javascript" src="../assets/plugins/metis-menu/metisMenu.min.js"></script>
        <script type="text/javascript" src="../assets/plugins/bootstrap/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="../assets/plugins/slim-scroll/jquery.slimscroll.min.js"></script>
        <script src="../assets/plugins/c3/d3.v3.min.js" charset="utf-8"></script>
        <script src="../assets/plugins/c3/c3.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script src="../assets/plugins/calendar/moment.min.js"></script>
        <script src="../assets/plugins/calendar/fullcalendar.min.js"></script>
        <script src="../assets/plugins/ui/jquery-ui.js"></script>


        <!-- PAGE LEVEL FILES -->
        <script src="../assets/plugins/data-tables/jquery.dataTables.js"></script>
        <script src="../assets/plugins/data-tables/dataTables.tableTools.js"></script>
        <script src="../assets/plugins/data-tables/dataTables.bootstrap.js"></script>
        <script src="../assets/plugins/data-tables/dataTables.responsive.js"></script>
        <script src="../assets/plugins/data-tables/tables-data.js"></script>
        <!-- Custom FILES -->
        <script type="text/javascript" src="../assets/js/custom.js"></script>
        <script type="text/javascript" src="../assets/js/index-2.js"></script>
        <script type="text/javascript" src="../assets/js/customjs.js"></script>
        <script type="text/javascript" src="https://static.filestackapi.com/v3/filestack.js"></script>
        <script type="text/javascript">
        // send sms
        function sendMessage(sender, recepient, message){
                var settings = {
                    "async": true,
                    "crossDomain": true,
                    "url": "https://api.smsgh.com/v3/messages/send?From=" + sender + "&To=%2B233" + recepient + "&Content=" + message + "&ClientId=idtdhbtx&ClientSecret=ybgoupdp",
                    "method": "GET",
                    "dataType": "jsonp",
                    "headers": {
                      "content-type": "application/json; charset-UTF8",
                    },
                    "processData": false,
                  }

                  $.ajax(settings).done(function (response) {
                    console.log(response);
                  });
              }

        dvInterceptQueryResponse = function(resp) {

           var riler = [];

           console.log(resp.appoint);

           $.each(resp.appoint, function(ind, ele){
             var related = ele;
             var name    = related.name;
             var phone   = "0" + related.phone_number;
             var type    = "";
             var time    = related.time;
             var day     = related.day;
             //var status  = "approved";

             var appointmentData = JSON.stringify({
               "phone_number" : related.phone_number,
               "email"        : related.email,
               "date"         : day
             });



             //related.appointment_type
             if (related.appointment_type == 1) {
              type  = "Build With Us";
             } else {
              type  = "Design With Us";
             }

            // format array
            var each = "<tr></tr><td>" + name    + "</td>" +
            "<td>" + phone   + "</td>" +
            "<td>" + type    + "</td>" +
            "<td>" + time    + "</td>" +
            "<td>" + day     + "</td>" +
            "<td><button  data = " + appointmentData + " ider = "  + ele.id + " class='btn btn-primary approve'> approve </button></td>" +
            "<td><button  data = " + appointmentData + "  ider = "  + ele.id + " class='btn btn-danger disapprove'> disapprove </button></td></tr>"

            riler.push(each);

            //console.log(related);
           })

           $("#table").html(riler);
           //return resp;

           // approve
           $(document).on('click', '.approve' , function() {
             var data = $(this).attr("data");

             var postBody = {
               "status": "1",
               "appointements_appointments_table_id": $(this).attr("ider")
             }

             //console.log(postBody);
             // make a post to the appointment table


             SDK.addData("appointements", "approval_table", postBody,  function(response){
               if (response.status_code == 609) {
                 alert("successfully approved. A text Message has been sent to the appointee following the approval")
                 var response    = $.parseJSON(data);
                 var phoneNumber = response.phone_number;
                 var dateTime    = response.date ;
                 var name        = response.email ;
                 // send sms
                 var senderName       = "Squetch";
                 var message          = "Goodnews! your appointment scheduled for " + dateTime  + " has been approved. Please take note and honor the appointment. Thank you";
                 var messageAdmin     = "Hello Admin!, You just disapproved the appointment of  " + name ;
                 sendMessage(senderName, phoneNumber, message);
                 sendMessage(senderName, "271522709", messageAdmin);

               } else if (response.status_code == 700) {


                  alert("You've already worked on this");
               }


               }) ;
             });

             // Disapprove

             $(document).on('click', '.disapprove' , function() {
               var data = $(this).attr("data");
               var postBody = {
                 "status": "2",
                 "appointements_appointments_table_id": $(this).attr("ider")
               }

               //console.log(postBody);
               // make a post to the appointment table



               SDK.addData("appointements", "approval_table", postBody,  function(response){
                 if (response.status_code == 609) {
                   // success
                   console.log(response);
                   alert("successfully disapproved. A text Message has been sent to the appointee following the disapproval")
                   var response    = $.parseJSON(data);
                   var phoneNumber = response.phone_number;
                   var dateTime    = response.date ;
                   var name        = response.email ;
                   console.log(phoneNumber);
                   // send sms
                   var senderName       = "Squetch";
                   var message          = "Sorry your appointment scheduled for " + dateTime  + " has been disapproved. Please try again";
                   var messageAdmin     = "Hello Admin!, You just disapproved the appointment of  " + name ;
                   sendMessage(senderName, phoneNumber, message);
                   sendMessage(senderName, "271522709", messageAdmin);

                 } else if (response.status_code == 700) {
                    console.log(data);


                    alert("You've already worked on this");
                 }
                 }) ;
               })


          }
        </script>

    </body>
</html>
